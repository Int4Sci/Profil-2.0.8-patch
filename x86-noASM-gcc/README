Multi-platform implementation (no assembly code)
